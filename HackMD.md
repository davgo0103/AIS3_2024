# 2024 AIS3 B8å°ˆé¡Œ

<!-- åŸºæ–¼èšé¡åˆ†ææŠ€è¡“çš„æƒ¡æ„ç¨‹å¼è®Šé«”è¾¨è­˜æ–¹æ³•ç ”ç©¶ -->
<!-- ç°¡å ±https://docs.google.com/presentation/d/1mOfBjBmEhjUG6e3FxfknjdLlehB1IKIz/edit?usp=sharing&ouid=109894482775983337768&rtpof=true&sd=true -->
â‡ï¸âœ³ï¸âœ´ï¸ğŸŸ¢âœ…â˜‘ï¸ğŸ”ºğŸ”¶

# ç¾åœ¨ç›®æ¨™
- [x] é€éçˆ¬èŸ²æŠ“MalwareBazaarä¸Šçš„ç—…æ¯’æ¨£æœ¬
- [x] å¯«å€‹è…³æœ¬è‡ªå‹•è·‘capaåˆ†æç—…æ¯’
- [x] äº†è§£jaccard indexçš„æµç¨‹
- [x] é¸æ“‡è¦ç”¨capaåˆ†æå ±å‘Šä¸­çš„å“ªäº›æ•¸å€¼
    ğŸ”ºcapaæŠ“çš„ç‰¹å¾µä¸å¤ªé©åˆåšæ¯”è¼ƒ
- [x] ç—…æ¯’åˆ†æå ±å‘Š->èƒ½ä¸Ÿåˆ°jaccard indexæ ¼å¼
- [x] é€éjacaardå°‡è³‡æ–™åˆ†æå‡ºç›¸ä¼¼åº¦
    ğŸ”ºä¸ç¢ºå®šæ€éº¼é…ç½®jacaardæ‰èƒ½åˆ†æçš„æ¯”è¼ƒæº–
- [ ] jaccaçµæœåŒ–æˆä¸€å€‹åœ–
- [ ] ç¢ºèªç›¸é—œåº¦é‡åŒ–è¦ç”¨çš„æ¼”ç®—æ³•
- [ ] ç•«å‡ºåœ–ç¤ºè¡¨é”è®Šé«”å½¼æ­¤é—œè¯æ€§

# æµç¨‹ç°¡ä»‹
1. æŠŠwannacryåŠå…¶è®Šé«”ä¸Ÿåˆ°capa
2. æå–capaåˆ†æå ±å‘Šä¸Ÿåˆ°jaccard indexåˆ†æç›¸é—œåº¦
3. åˆ¤æ–·è©²è®Šé«”èˆ‡æœ¬é«”çš„ç›¸ä¼¼åº¦

## å¯åšå»¶ä¼¸
- æ›ç®—æ³•
- æ›´å¤šç¨®ç—…æ¯’
- èˆ‡å…¶ä»–ç—…æ¯’åšæ¯”å° çœ‹çµæœ
- 
- 

# 8/1åŠ©æ•™è¨è«–
## åˆ°ç›®å‰é€²åº¦
- å¯«äº†è…³æœ¬è‡ªå‹•æŠ“MalwareBazaarçš„ç—…æ¯’
- å¯«äº†è…³æœ¬è‡ªå‹•è·‘capaåˆ†æç—…æ¯’ä¸¦åŒ¯å…¥txtæ–‡ä»¶ä¸­
- å°‡capaåˆ†æå‡ºä¾†çš„å ±å‘Šæå–ATT&CK and MBC
- å°‡ATT MBCåšæˆarrayåˆ†æ [1,0,0,1,1,0,1,0,0,0,0,1]
- æŠŠè³‡æ–™ä¸Ÿåˆ°jaccardæ¯”å°ç›¸ä¼¼åº¦
- æ ¹æ“šç›¸ä¼¼åº¦åšæˆåœ–ç‰‡


## å¾ŒçºŒå»¶ä¼¸
- è·Ÿéå‹’ç´¢è»Ÿé«”ã€å‹’ç´¢è»Ÿé«”ä½œæ¯”å°çœ‹çœ‹ çœ‹æ•¸å€¼çš„å·®è· 
- [x] åœ–ç‰‡æ”¹ç›¸ä¼¼åº¦çŸ©é™£
- æ‰¾åˆ¥çš„ç®—æ³• çœ‹ç•«å‡ºä¾†å¾—åœ–æœ‰æ²’æœ‰ä¸ä¸€æ¨£
    - ä¸€ç¶­?
- [x] äº¤å‰æ¯”å° 
- pluså‡ç´šç‰ˆæœ¬ åªåƒè®Šé«” åˆ†æ›´é–‹
- LLMåƒåˆ†æarray 
    - èŠå§†

- æŠ±æ­‰ç§å¿ƒ- æŒ‘æˆ°bypassæ‰æˆ‘å€‘çš„åˆ†æç³»çµ±
    - å› ç‚ºåˆ†æå­˜åœ¨æ¼æ´
        - å¤šä½¿ç”¨ä¸€äº›ä¸ç›¸é—œçš„å…§å®¹ ä¾†å˜—è©¦æ¬ºé¨™capaå¤šåˆ†æå‡ºæ‘¸åˆ°çš„åŠŸèƒ½



# 8/2
æƒ³å•åŠ©æ•™çš„å•é¡Œ
- å¯èƒ½å–‚LLMå—


---
- è®Šé«”åœ–å½¢åŒ–åˆ†éš»
    - STIXåœ–è¡¨?
- ä¸‹è¼‰æœ€æ–°è®Šé«”ä¸¦ç›´æ¥åˆ†æ
- ä¸ä½¿ç”¨jaccardï¼Œè€Œæ˜¯æ”¹è‡ªå·±ç”¨AIå»åˆ†æçœ‹çœ‹
    - æ—©ä¸Šä¸ŠåŠå ‚iceè¬›çš„åˆ†é¡æ¨¡å‹?
- è‡ªå·±åˆ»ä¸€å€‹ç›¸ä¼¼çš„è®Šé«”ä¸Ÿå»çœ‹ç›¸ä¼¼åº¦
    - å¯ä»¥çµåˆcapaæ˜¯å¦‚ä½•åˆ†æçš„ï¼Œå˜—è©¦bypassæª¢æ¸¬çœ‹çœ‹
- æŠŠæ›´å¤šé¡å‹çš„ç—…æ¯’é€écapaåˆ†æï¼Œé€éMLã€DLä¾†åˆ†æå ±å‘Šï¼Œåˆ¤æ–·ä»–å±¬æ–¼å“ªç¨®ç—…æ¯’é¡å‹


::: success
## å¯ä»¥åšçš„äº‹
> ä»»ä½•æƒ³åˆ°è©²åšçš„äº‹
#### é›œ 
- æŠŠè®Šé«”å€‘çš„shaå»Virus total ä¸ŠæŸ¥æŸ¥çœ‹
#### è³‡æ–™å‰è™•ç†/æ¯”å°
- ä¸Šæ¨™ç±¤
- å¯ å…ˆæ‰¾å‡ºçœŸçš„å¾ˆåƒçš„è®Šé«” (æä¸å¥½ä½ å¯å¹«å¿™)
- æƒ³ è¦æ€éº¼æŠŠåˆ†æå‡ºä¾†çš„å…¨éƒ¨æŠ•å½±åˆ°ä¸€å€‹äºŒç¶­çš„åœ–ä¸Š
- [ing] ä¸²chatGPT API

#### å¯ä»¥è®“æœ‰åˆ†é¡æ¬Šé‡è·Ÿæ²’æœ‰åˆ†é¡æ¬Šé‡çš„çµæœéƒ½å»å°æ¯”ä¸€æ¬¡ç›¸ä¼¼åº¦

**èªªæ˜å­¸åˆ°ä»€éº¼**
#### :D
:::



## è²¢ç»(å¤§è‡´
- å³ç¥å„’(èŠå§†)
    - jaccardåˆ†æ
    - 
<!-- 
1.æŠŠwannacryæª”æ¡ˆåˆ†æˆ ç©º <10kb >10kb
2.
-->
- é„­å®‡å…©(è²å¦)
    - å¯«powershellè…³æœ¬è·‘capaåˆ†ææƒ¡æ„è»Ÿé«”
    - åˆ†æcapaæ¦‚å¿µ
    - ç¯©é¸capaç‰¹å¾µ
- æ›¹å‡±ç¿”(l3obo)
    - jaccardåˆ†æ
    - 
- è”¡å£«ç…’(å°è”¡)
    - çµ±æ•´æ­¥é©Ÿ
    - æŠ“æƒ¡æ„è»Ÿé«”çˆ¬èŸ²æ’°å¯«
    - 


---
# æƒ¡æ„ç¨‹å¼è®Šé«”åµæ¸¬å°ˆé¡Œè¨ˆç•«

## 1. ä¸»é¡Œæ¦‚è¿°
**ä¸»é¡Œ**ï¼šæƒ¡æ„ç¨‹å¼è®Šé«”åµæ¸¬

**ç›®æ¨™**ï¼š
1. é‡å°æƒ¡æ„è»Ÿé«”ï¼ˆå¦‚Emotetã€Wannacryï¼‰é€²è¡Œè®Šé«”åµæ¸¬ã€‚
2. ä½¿ç”¨capaå·¥å…·åˆ†æç‰¹å¾µï¼Œä¸¦å°æ¯”è®Šé«”å’ŒåŸå§‹æ¨£æœ¬çš„ç›¸ä¼¼åº¦ã€‚

## 2. å…·é«”æ­¥é©Ÿ
### 2.1 æƒ¡æ„è»Ÿé«”æ¨£æœ¬é¸æ“‡
- é‡å°Emotetæœ¨é¦¬å’ŒWannacryå‹’ç´¢è»Ÿé«”ï¼Œè’é›†å¤šå€‹æ¨£æœ¬åŠå…¶è®Šé«”ã€‚

### 2.2 ä½¿ç”¨capaé€²è¡Œåˆ†æ
- ä¸‹è¼‰ä¸¦é…ç½®capaå·¥å…·ã€‚
- å°‡æƒ¡æ„è»Ÿé«”æ¨£æœ¬å’Œè®Šé«”ä¸Ÿå…¥capaï¼Œç”ŸæˆåŠŸèƒ½ç‰¹å¾µå ±å‘Šã€‚

### 2.3 ç‰¹å¾µæ¯”å°
- ä½¿ç”¨ç›¸ä¼¼åº¦æ¼”ç®—æ³•ï¼ˆå¦‚Jaccard indexï¼‰æ¯”è¼ƒåŸå§‹æ¨£æœ¬å’Œè®Šé«”çš„capaå ±å‘Šã€‚
- å°‡ç‰¹å¾µå‘é‡æŠ•æ”¾åˆ°å‘é‡ç©ºé–“ä¸­ï¼Œè©•ä¼°æ¨£æœ¬ä¹‹é–“çš„ç›¸ä¼¼åº¦ã€‚

### 2.4 è®Šé«”å‰µå»ºèˆ‡æ¸¬è©¦
- åƒè€ƒé–‹æºæƒ¡æ„è»Ÿé«”ä»£ç¢¼ï¼Œå‰µå»ºè‡ªè£½è®Šé«”ã€‚
- å°‡è‡ªè£½è®Šé«”ä¸Ÿå…¥capaï¼Œç”Ÿæˆå ±å‘Šä¸¦èˆ‡åŸå§‹è®Šé«”é€²è¡Œæ¯”å°ã€‚

### 2.5 çµæœåˆ†æèˆ‡å ±å‘Š
- åˆ†æç›¸ä¼¼åº¦æ¯”å°çµæœï¼Œæ‰¾å‡ºæœ€æ¥è¿‘åŸå§‹æ¨£æœ¬çš„è®Šé«”ã€‚
- ç¸½çµç ”ç©¶æˆæœï¼Œæ’°å¯«å ±å‘Šã€‚

## 3. è©³ç´°æ­¥é©Ÿ

### 3.1 è’é›†æƒ¡æ„è»Ÿé«”æ¨£æœ¬
- åˆ©ç”¨å®‰å…¨ç ”ç©¶å¹³å°æˆ–é–‹æºæ•¸æ“šåº«ï¼ˆå¦‚[VirusTotal](https://www.virustotal.com/)ã€[MalwareBazaar](https://bazaar.abuse.ch/)ï¼‰è’é›†Emotetå’ŒWannacryæ¨£æœ¬ã€‚
- æƒ¡æ„è»Ÿé«”å…±äº«ç¤¾å€
    - VirusShare: ä¸€å€‹å…è²»çš„æƒ¡æ„è»Ÿé«”æ¨£æœ¬åº«ï¼Œ==éœ€è¦è¨»å†Šæ‰èƒ½è¨ªå•==ã€‚å®ƒæä¾›äº†å¤§é‡çš„æƒ¡æ„è»Ÿé«”æ¨£æœ¬ï¼Œä½†ä½¿ç”¨æ™‚éœ€è¦ç‰¹åˆ¥å°å¿ƒå’Œéµå®ˆæ³•å¾‹ã€‚
    - Malshare: å¦ä¸€å€‹æƒ¡æ„è»Ÿé«”åˆ†äº«å¹³å°ï¼Œæä¾›å¤§é‡æ¨£æœ¬ä¾›å®‰å…¨ç ”ç©¶ä½¿ç”¨ã€‚

### 3.2 capaé…ç½®èˆ‡ä½¿ç”¨
- ä¸‹è¼‰capaå·¥å…·ä¸¦å®‰è£ï¼š
  ```bash
  git clone https://github.com/mandiant/capa.git
  cd capa
  pip install -r requirements.txt
  ```
  
- ä½¿ç”¨capaåˆ†ææ¨£æœ¬ï¼š
è¤‡è£½ç¨‹å¼ç¢¼
```bash
capa path/to/malware_sample
```

### 3.3 ç›¸ä¼¼åº¦åˆ†æ
- ä½¿ç”¨Pythoné€²è¡ŒJaccard indexè¨ˆç®—ï¼š
```bash
def jaccard_similarity(list1, list2):
    set1 = set(list1)
    set2 = set(list2)
    intersection = len(set1 & set2)
    union = len(set1 | set2)
    return intersection / union
```
### 3.4 è®Šé«”å‰µå»º
- åƒè€ƒé–‹æºæƒ¡æ„è»Ÿé«”ä»£ç¢¼ï¼ˆå¦‚GitHubä¸Šçš„æƒ¡æ„è»Ÿé«”é …ç›®ï¼‰ï¼Œä¿®æ”¹å’Œå‰µå»ºæ–°çš„è®Šé«”ã€‚
- æ¸¬è©¦è®Šé«”çš„æœ‰æ•ˆæ€§ä¸¦ç¢ºä¿å…¶åŠŸèƒ½å®Œæ•´ã€‚

### 3.5 çµæœå ±å‘Š
- ç”Ÿæˆå’Œåˆ†æcapaå ±å‘Šï¼Œä¸¦å°‡çµæœå¯è¦–åŒ–ä»¥ä¾¿æ›´ç›´è§€åœ°å±•ç¤ºç›¸ä¼¼åº¦ã€‚

## 4. å»¶ä¼¸è¨ˆç•«
- **AIç›¸ä¼¼åº¦æ¼”ç®—æ³•**ï¼š
  - æ¢ç´¢å’Œå¯¦ç¾æ›´é«˜æ•ˆçš„AIç›¸ä¼¼åº¦æ¼”ç®—æ³•ï¼ˆå¦‚ç¥ç¶“ç¶²çµ¡æˆ–èšé¡ç®—æ³•ï¼‰ï¼Œæå‡è®Šé«”åµæ¸¬çš„æº–ç¢ºæ€§ã€‚

- **åŸºç·šå·¥å…·èˆ‡è©•ä¼°**ï¼š
  - ç¢ºç«‹capaä½œç‚ºåŸºç·šå·¥å…·ï¼Œä¸¦å°æ¯”AIæ¼”ç®—æ³•çš„æ€§èƒ½ã€‚

## 5. å·¥å…·èˆ‡æŠ€è¡“
- **capa**ï¼šåŠŸèƒ½ç‰¹å¾µåˆ†æå·¥å…·ã€‚
- **Jaccard index**ï¼šç›¸ä¼¼åº¦è¨ˆç®—ã€‚
- **Python**ï¼šæ•¸æ“šè™•ç†å’Œåˆ†æã€‚
- **é–‹æºæƒ¡æ„è»Ÿé«”ä»£ç¢¼**ï¼šè®Šé«”å‰µå»ºåƒè€ƒã€‚

## 6. åƒè€ƒè³‡æ–™
- [capa GitHub](https://github.com/mandiant/capa)
- [VirusTotal](https://www.virustotal.com/)
- [MalwareBazaar](https://bazaar.abuse.ch/)

- [jaccardindex example](https://github.com/es0/MalwareSimilarityGraphhttps://) 

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>


- è¢«å¦
- å°èœ
    - åœ¨æŠ“æ›´å¤šçš„æƒ¡æ„è»Ÿé«”
    - æŠ“æœ€æ–°çš„è»Ÿé«”åˆ¤æ–·ä»–æ˜¯å“ªç¨®
    - äº¤å‰æ¯”å°
        - ç›¸é—œå»¶ä¼¸åœ–
    - é¡˜æ™¯ åˆ†ææœªè¢«åˆ†æçš„ç—…æ¯’ åˆ¤æ–·åå‘å“ªç¨®


- 13bo
    - å„ªåŒ–jaccardåˆ†æ





- ä¸‹è¼‰æƒ¡æ„è»Ÿé«”
    - https://virusshare.com/
    - https://github.com/ytisf/theZoo/
    - https://github.com/fabrimagic72/malware-samples/tree/master/Ransomware/Wannacry
    - https://github.com/Endermanch/MalwareDatabase
    - https://github.com/chronosmiki/RANSOMWARE-WANNACRY-2.0


#### Emotet
![image](https://hackmd.io/_uploads/r1jytPwFR.png)
- [MalwareBazaar | Emotet](https://bazaar.abuse.ch/browse/tag/Emotet/)
- [VirusTotal | Emotet](https://www.virustotal.com/gui/file/fc11f30fb0debf8b8f42a7e9c0678df69c8b171c0038ea7aca7217b43b3c220f/detection)
fc11f30fb0debf8b8f42a7e9c0678df69c8b171c0038ea7aca7217b43b3c220f

- [malpedia | Emotet (Malware Family)](https://malpedia.caad.fkie.fraunhofer.de/details/win.emotet)


#### WannaCry
- [VirusTotal | ](https://www.virustotal.com/gui/file/3ecc0186adba60fb53e9f6c494623dcea979a95c3e66a52896693b8d22f5e18b/detection)
3ecc0186adba60fb53e9f6c494623dcea979a95c3e66a52896693b8d22f5e18b
- [MalwareBazaar | WannaCry](https://bazaar.abuse.ch/browse/signature/WannaCry/)
- [MalShare](https://malshare.com/search.php?query=YRP/WannaCry_Ransomware)


<br>
<br>
<br>




## ç°¡å ±æµç¨‹
(è¨˜å¾—æª¢æŸ¥æŠ•å½±æœƒè¢«åˆ‡åˆ°çš„éƒ¨åˆ†)
(è¨˜å¾—åŠ é æ•¸)
- [capaç°¡ä»‹](https://github.com/mandiant/capa)ï¼Œèªªæ˜åˆ†æå…§å®¹
    - èªªæ˜capaåœ¨å¹¹å˜› ä»¥æ­¤ä¾†ä½œç‚ºæˆ‘å€‘åˆ†æå ±å‘Šæ˜¯æº–çš„ä½è­‰
    - æ„Ÿè¦ºå¯ä»¥é€†å‘æœ¬é«”ä¾†è­‰æ˜capaçš„å ±å‘Šæ˜¯å°çš„
- wanncryç°¡ä»‹
    - ç—…æ¯’ç°¡ä»‹
- Jaccard æŒ‡æ•¸çš„å®šç¾©




# jaccard indexä»‹ç´¹

çµ¦å®šå…©å€‹é›†åˆ A å’Œ Bï¼ŒJaccard æŒ‡æ•¸ J(A, B) å®šç¾©ç‚ºï¼š
    > $J(A, B)=\frac{Aâˆ©B}{AâˆªB}$ ($\frac{äº¤é›†å…ƒç´ æ•¸é‡}{è¯é›†å…ƒç´ æ•¸é‡}$)


```python
import numpy as np

def jaccard_binary(x,y):
    """A function for finding the similarity between two binary vectors"""
    intersection = np.logical_and(x, y)
    union = np.logical_or(x, y)
    similarity = intersection.sum() / float(union.sum())
    return similarity

# Define some binary vectors
x = [0,1,0,0,0,1,0,0,1]
y = [0,0,1,0,0,0,0,0,1]
z = [1,1,0,0,0,1,0,0,0]

# Find similarity among the vectors
simxy = jaccard_binary(x,y)
simxz = jaccard_binary(x,z)
simyz = jaccard_binary(y,z)

print(' Similarity between x and y is', simxy, '\n Similarity between x and z is ', simxz, '\n Similarity between x and z is ', simyz)
```

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

## ä¸€äº›å˜—è©¦


### æ¯”å°æ–‡ä»¶æ–¹å¼
(by ChatGPT)
ä¸‰ç¨®ä¸åŒçš„ç›¸ä¼¼åº¦åº¦é‡æ–¹å¼ä¾†æ¯”è¼ƒå®ƒå€‘çš„ç›¸ä¼¼ç¨‹åº¦ï¼š

- Jaccard Index: 0.286
é€™å€‹æŒ‡æ•¸è¡¨ç¤ºå…©å€‹æ–‡æœ¬ä¹‹é–“çš„ç›¸ä¼¼åº¦ç´„ç‚º 28.6%ã€‚Jaccard æŒ‡æ•¸æ˜¯é€šéè¨ˆç®—å…©å€‹é›†åˆçš„äº¤é›†èˆ‡ä¸¦é›†ä¹‹é–“çš„æ¯”ç‡ä¾†å¾—å‡ºã€‚
Cosine Similarity: 0.445

- Cosine ç›¸ä¼¼åº¦ç‚º 0.445
è¡¨ç¤ºé€™å…©å€‹æ–‡æœ¬åœ¨ç‰¹å¾µç©ºé–“ä¸­çš„è§’åº¦è¼ƒå°ï¼Œç›¸ä¼¼åº¦ç´„ç‚º 44.5%ã€‚é€™æ˜¯ä¸€ç¨®å¸¸ç”¨æ–¼æ–‡æœ¬æ¯”è¼ƒçš„ç›¸ä¼¼åº¦åº¦é‡æ–¹æ³•ï¼Œç‰¹åˆ¥æ˜¯åœ¨è©é »å‘é‡ç©ºé–“ä¸­ã€‚
Dice Coefficient: 0.445

- Dice ç³»æ•¸ä¹Ÿç‚º 0.445
è¡¨ç¤ºå…©å€‹æ–‡æœ¬çš„é‡åˆéƒ¨åˆ†ä½”ç¸½æ•¸çš„ 44.5%ã€‚é€™æ˜¯ä¸€ç¨®åŸºæ–¼ç›¸äº¤è©èªæ•¸é‡èˆ‡ç¸½è©èªæ•¸é‡ä¹‹å’Œçš„åº¦é‡ã€‚

ç¨‹å¼ç¢¼: 
```python
import re

# Basic stop words list
STOP_WORDS = {
    'the', 'and', 'is', 'in', 'it', 'of', 'to', 'a', 'with', 'as', 'for', 'on', 'that', 'this',
    'by', 'an', 'are', 'be', 'or', 'from', 'at', 'was', 'which', 'but', 'has', 'have', 'not', 'can'
}

def preprocess_text(text):
    """Preprocess the text by removing punctuation, converting to lowercase, splitting into words, and removing stop words."""
    text = re.sub(r'[^\w\s]', '', text)
    text = text.lower()
    words = text.split()
    words = [word for word in words if word not in STOP_WORDS]
    return set(words)

def jaccard_index(set1, set2):
    """Calculate Jaccard Index between two sets."""
    intersection = set1.intersection(set2)
    union = set1.union(set2)
    if not union:
        return 0.0
    return len(intersection) / len(union)

def cosine_similarity(set1, set2):
    """Calculate cosine similarity between two sets."""
    intersection = len(set1.intersection(set2))
    return intersection / ((len(set1) * len(set2)) ** 0.5)

def dice_coefficient(set1, set2):
    """Calculate Dice coefficient between two sets."""
    intersection = len(set1.intersection(set2))
    return (2 * intersection) / (len(set1) + len(set2))

# Read the contents of the files
with open("/mnt/data/wanna.txt", "r") as file1, open("/mnt/data/01.txt", "r") as file2:
    text1 = file1.read()
    text2 = file2.read()

# Preprocess the texts
set1 = preprocess_text(text1)
set2 = preprocess_text(text2)

# Calculate similarity metrics
jaccard = jaccard_index(set1, set2)
cosine = cosine_similarity(set1, set2)
dice = dice_coefficient(set1, set2)

jaccard, cosine, dice

```

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>


# capaä»‹ç´¹

## ç‰ˆæœ¬
- 7.1.0
## ç°¡ä»‹
- æ²™ç®±ï¼Œæœ‰å‹•(v7.0)ã€éœåˆ†æ
    - ç›¸è¼ƒéœæ…‹ï¼›å‹•æ…‹åˆ†æå¯ä»¥ç”¨ä¾†åŸ·è¡Œæœ‰è¢«æ‰“åŒ…éçš„ç—…æ¯’æª”
    - åˆ†åˆ¥èªªæ˜å‹•ã€éœæ…‹åˆ†æéç¨‹
    - [éœæ…‹åƒè€ƒ](https://cloud.google.com/blog/topics/threat-intelligence/capa-automatically-identify-malware-capabilities/)
## åˆ†æè³‡æ–™æ¶ˆåŒ–
### capaåˆ†æå‡ºä¾†çš„æ±è¥¿å¤§è‡´å¯åˆ†ç‚ºå››ç¨®
- åŸºæœ¬è³‡è¨Š(å¨è„…æŒ‡æ¨™?)
    - ä¸çœ‹
- ATT&CK
    - æœ€å¸¸è½åˆ°çš„æ”»æ“Šé¡å‹æ¨™æº–
- MBC
    - åŒæ¨£ä¹Ÿæ˜¯æƒ¡æ„è»Ÿé«”æ”»æ“Šé¡å‹çš„ä¸€ç¨®
    - æ›´ç´°(?
    - å¾®è¡Œç‚º(Micro-behaviors)
- Capability
    - èªªæ˜å¤§è‡´åœ¨å¹¹å˜›

### ç¾åœ¨å•é¡Œ
1. å¦‚æœATT&CK or MBCæœ‰å¤šæˆ–å°‘è¦æ€éº¼åˆ¤æ–·
- ATT
    - æœ‰å¤šçš„æƒ…æ³:
        - å…ˆåˆ†æå¤§é¡æœ‰å“ªäº›(14é¡) æŠŠè¼ƒä¸ç›¸é—œçš„åˆªæ‰
        - å†æ ¹æ“šç›¸é—œç¨‹åº¦åšä¸åŒçš„æ¬Šé‡åˆ†æ
        - *å•é¡Œ*: éœ€è¦çµ¦é¡åˆ¥ä¸­å…¨éƒ¨ç´°é …ä½œè©•åˆ†?
    - æœ‰å°‘çš„æƒ…æ³:
        - çœ‹å°‘å“ªé¡ä¸€æ¨£åˆ¤æ–·æ¬Šé‡
        - *å•é¡Œ*: 
    - ç›®å‰æƒ³æ³•:
        - å…ˆæ‰¾å‡ºè¼ƒç‚ºé‡è¦çš„é‚£å¹¾é …ä½œç‚ºä¸»è¦è©•æ–·æ¨™æº–
            - ex:
        - å°±çœŸçš„æ…¢æ…¢åˆ†æç›¸é—œATT&CK
        - å…ˆæ’é™¤æ‰éæ–¼å¤§çœ¾çš„å…§å®¹
        - **é¸å‡ºæ ¸å¿ƒè¡Œç‚ºï¼Œå¦‚æœå°‘çš„è©±å¤§æ‰£åˆ†ï¼Œå¤šçš„è©±å‰‡åˆ¤æ–·æ˜¯å¤šä»€éº¼ä¾†çµ¦ä¸åŒæ¬Šé‡**
- MBC
    - åŸºæœ¬ä¸Šå•é¡Œä¹Ÿé¡ä¼¼ä¸Šé¢ï¼Œæœ‰å…«å€‹å­é …ç›®


2. Capabilityè¦ä¸è¦æ¡ç´ (ç¾åœ¨åå¥½ä¸ç”¨
    - å› ç‚ºMBCæ„Ÿè¦ºå·²ç¶“å¤ å®Œæ•´
    - å¤šè·‘å¹¾æ¬¡åŒæ¨£å‹•ä½œ(ex: xor)å¯èƒ½æœƒå› æ­¤è¢«æ··æ·†(?
<!-- æ±ºå®šä¸æ¡ç´ ~~è³‡æ–™å¤ªå¤šäº†~~ -->
---


### æœ¬é«”
- [ATT&CK Tactic](https://attack.mitre.org/)
    - DEFENSE EVASION (é˜²ç¦¦è¦é¿)
        - T1222
            - ä¿®æ”¹æª”æ¡ˆè®€å¯«æ¬Šé™
        - T1027
            - å°è‡ªå·±çš„æ•¸æ“šé€²è¡ŒåŠ å¯†ä»¥é˜²æ­¢è¢«æŠ“åˆ°
    - DISCOVERY (æ¢ç´¢ç’°å¢ƒ)
        - T1083
            - æ¢ç´¢ç³»çµ±ä¸­çš„æ‰€æœ‰æª”æ¡ˆ
        - T1012
            - æŸ¥è©¢è¨»å†Šè¡¨
    - EXECUTION (åŸ·è¡Œ)
        - T1129
            - æ”»æ“Šè€…å¯èƒ½é€šéåŠ è¼‰å…±äº«æ¨¡çµ„ä¾†åŸ·è¡Œæƒ¡æ„ä»£ç¢¼ã€‚é€™å¯èƒ½æ¶‰åŠä½¿ç”¨ç³»çµ±åº«æˆ–å…¶ä»–å…±äº«çµ„ä»¶ï¼Œåœ¨å¦ä¸€å€‹é€²ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­é‹è¡Œå…¶ä»£ç¢¼ï¼Œå¾è€Œé¿å…åµæ¸¬ã€‚
        - T1569.002
            - æ”»æ“Šè€…å¯èƒ½é€šéæœå‹™åŸ·è¡Œæƒ¡æ„ä»£ç¢¼ã€‚é€™æ¶‰åŠå‰µå»ºæˆ–ä¿®æ”¹ç³»çµ±æœå‹™ï¼Œä»¥åœ¨æœå‹™ä¸Šä¸‹æ–‡ä¸­åŸ·è¡Œå…¶ä»£ç¢¼ï¼Œé€™æœ‰åŠ©æ–¼ä¿æŒæŒä¹…æ€§æˆ–ç²å¾—æ›´é«˜çš„æ¬Šé™ã€‚
    - PERSISTENCE (ä¸è¢«éŠ·æ¯€ ç«‹è¶³é»)
        - T1543.003
            - æ”»æ“Šè€…å¯èƒ½æœƒå‰µå»ºæˆ–ä¿®æ”¹ Windows æœå‹™ä»¥å»ºç«‹æŒä¹…æ€§ã€‚
<!-- - ç¬¬ä¸€æ¬¡èªçœŸçœ‹ATTCK (æ±—-->


- [Malware Behavior Catalog Objective(MBC)](https://github.com/MBCProject/mbc-markdown/tree/main/micro-behaviors)

![image](https://hackmd.io/_uploads/SJt-7xYKC.png)

    - ä¹Ÿæ˜¯åˆ†ææƒ¡æ„ç¨‹å¼è¡Œç‚º
    - CRYPTOGRAPHY
        -  Encrypt Data::AES [C0027.001] 
        -  Encrypt Data::RC4 [C0027.009]
        -  Encryption Key::RC4 KSA [C0028.002]
        -  Generate Pseudo-random Sequence [C0021]
        - ä¸å¥½åˆ¤æ–· æ„Ÿè¦ºå¾ˆå¤šéƒ½æœƒæœ‰åŠ å¯†è¡Œç‚º ä¸èƒ½ç•¶å¥½çš„ä¾æ“š 
    - DATA
        - Checksum::CRC32 [C0032.001] 
        - Compression Library [C0060] 
        - Encode Data::XOR [C0026.002] 
            - <h5 style="color:red">åŠ å¯†æª”æ¡ˆ</h5>


    - DEFENSE EVASION 
        - Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]
        - Obfuscated Files or Information::Encryption-Standard Algorithm [E1027.m05] 
    - DISCOVERY 
        - Code Discovery::Enumerate PE Sections [B0046.001] 
        - File and Directory Discovery [E1083]
        - System Information Discovery [E1082]
    - FILE SYSTEM 
        - Copy File [C0045] 
        - Create Directory [C0046]
        - Get File Attributes [C0049]
        - Read File [C0051]
        - Set File Attributes [C0050]
        - Writes File [C0052] 
    - OPERATING SYSTEM
        -  Registry::Query Registry Value [C0036.006]
        -  Registry::Set Registry Key [C0036.001]
            -  è¨»å†Šè¡¨è®Šæ›´
    - PROCESS
        - Check Mutex [C0043]
        -  Create Process [C0017]
        -  Terminate Process [C0018]




## è¦æ¡ç´çš„æ¢ä»¶
### ATT&CK
- å…¨éƒ¨é¡å‹:
    - [ ] Initial Access (åˆå§‹è¨ªå•)
    - [ ] Reconnaissance (åµæŸ¥)
    - [ ] Execution (åŸ·è¡Œ)
    - [ ] Persistence (ä¸è¢«éŠ·æ¯€ç«‹è¶³é»)
    - [ ] Privilege Escalation (ç‰¹æ¬Šæå‡)
    - [ ] Defense Evasion (é˜²ç¦¦è¦é¿)
    - [ ] Credential Access (æ†‘è­‰è¨ªå•)
    - [ ] Discovery (æ¢ç´¢ç’°å¢ƒ)
    - [ ] Lateral Movement (æ©«å‘ç§»å‹•)
    - [ ] Collection (æ•¸æ“šæ”¶é›†)
    - [x] Exfiltration (æ•¸æ“šå¤–å‚³)
    - [ ] Command and Control (æŒ‡æ®èˆ‡æ§åˆ¶)
    - [ ] Impact (å½±éŸ¿)
    - [x] Resource Development (è³‡æºé–‹ç™¼)


- åŸºæœ¬ä¸Šä¸æœƒæœ‰çš„
    - Resource Development (è³‡æºé–‹ç™¼)
    - Exfiltration (æ•¸æ“šå¤–å‚³)
### MBC
- å…¨éƒ¨é¡å‹
    - [ ] Communication
    - [ ] Cryptography
    - [ ] Data
    - [ ] File System	
    - [x] Hardware
    - [x] Memory
    - [ ] Process
    - [ ] Operating System

- åŸºæœ¬ä¸Šä¸æœƒæœ‰
    - Hardware
    - Memory


## åƒè€ƒè³‡æ–™
- [èªªæ˜capaæ²™ç®±å‹•æ…‹åˆ†æ](https://cloud.google.com/blog/topics/threat-intelligence/dynamic-capa-executable-behavior-cape-sandbox/)
- [capa2.0](https://cloud.google.com/blog/topics/threat-intelligence/capa-2-better-stronger-faster/)
- [capaè‡ªå‹•åˆ†æ](https://cloud.google.com/blog/topics/threat-intelligence/capa-automatically-identify-malware-capabilities/)






# è¨è«–æ§‹æ€ä¸»é¡Œéç¨‹

---
è¨è«–éç¨‹
---
### è¼ƒå¯èƒ½çš„
æµé‡åˆ†æ http
å‡æ–°è
åˆ»æƒ¡æ„ç¨‹å¼


## ä¸»é¡Œè¨è«–
- å·¥æ§æ–¹é¢
    - ~~åŠ©æ•™ä¸ç†Ÿ~~
    - æš«æ”¾æ£„
- AIåˆ†æ

- åœ–åƒåŒ–(? 
- ä¹Ÿå¯é‘‘è­˜ã€å»ºè­°è—ä¸€é»
- é–‹ç™¼ è‡ªå·±å¯«code
- æ•™æˆèªªï¼Ÿsandbox...åŸ·è¡Œä»¥å¾Œ...åˆ†æå“ªå€‹ä¾†æº...
- åˆ†ææƒ¡æ„è»Ÿé«” ç„¶å¾ŒåŠ å¼·ä»–

- Defense Evasion
- sandbox
    - cuckoo
- æœ‰sandboxåŸ·è¡Œéæƒ¡æ„ç¨‹å¼ æ€éº¼æŠŠä»–çš„å‹•ä½œè½‰æ›æˆåœ–ç¤ºè¡¨ ex Virustotal
- LSTMå¾ˆé©åˆåšAPIåˆ†æ
    - DL+ML? 
- google hacking LLM
- å„ªåŒ–æƒ…è³‡è’é›†å¹³å°


### æ”¾æ£„çš„
ææ¡ˆè¢«æ‰“æ§çš„åŸå› ï¼šæœ‰äººåšé ä¸å‰µæ–°ã€é›£ä»¥å¯¦ç¾

1.å¤ªé›£ å¯èƒ½åšä¸å‡ºä¾†
2.å¤ªå¼±(æ²’æœ‰å‰µæ„) ->å®‰å…¨ç‰Œ
æµé‡åˆ†æ
å‡æ¶ˆæ¯


- IDA plugin
    - (å»å¹´æœ‰äººåšgidra plugin)
    - å› : æˆ‘å€‘éƒ½ä¸ç†ŸIDAå’ŒReverse

- å·¥æ§
    - ç›¸é—œæ€§ä¸å¤§


### å¾…ä¼°
<h2 style="color:red;"> </h2>
## æš—ç¶²çˆ¬èŸ² ï¼ˆå‚™å‚™æ¡ˆ
- å¤ªå¤§ç•¥
- ç‰¹å®šç¶²ç«™?
- æ¶ˆåŒ–è³‡æ–™
- ç¾æœ‰å¤ªå¤š
- **å‰µæ–°æ€§ä¸å¤ **
    

## æƒ¡æ„è»Ÿé«”åˆ†æã€å¾©ç¾
- antiscan

## æµé‡åˆ†æ(æ²’æœ‰åŠ å¯†çš„)
- æœ‰åŠ å¯†çš„ä¸è¡Œ 
- ç¾æœ‰æŠ€è¡“å¤ªæˆç†Ÿ ä¸å»ºè­°
- å¯èƒ½æœƒè¢«è¢«å™¹çˆ†

## å¯è¦–åŒ–
- ä¸çŸ¥é“è¦å¯è¦–åŒ–ä»€éº¼

## ä»¥CVEæœCVE
- è³‡æ–™å°‘
- é—œè¯æ€§é›£æ‰¾

## å‡æƒ…è³‡

## æƒ¡æ„è»Ÿé«”(æœ€çµ‚ç¨¿)
(æƒ¡æ„ç¨‹å¼è®Šé«”åµæ¸¬)

åšæœ¨é¦¬ emotet bemtet æ‰¾ä»–è®Šé«”
ç„¶å¾Œä¸Ÿcapa 
çœ‹ç‰¹å¾µ
åƒè€ƒopen source Malware
åˆ»ä¸€å€‹é¡ä¼¼çš„å‡ºä¾†
ä¸Ÿå›capa ï¼Œå°æ¯”å’ŒåŸæœ¬è®Šé«”çš„ç›¸ä¼¼åº¦ çœ‹å·®å¤šå°‘
å»¶ä¼¸ï¼š
è¼¸å…¥å“ªä¸€ç¨®æƒ¡æ„ç¨‹å¼
1.Wannacry å‹’ç´¢
2.emotet æœ¨é¦¬
<!-- jaccard index -->
æ¨£æœ¬ç¶“écapa
æ‰¾åˆ°åŒä¸€å€‹æ¨£æœ¬ ä½†æœ‰è®Šé«”
(æŠ•æ”¾åœ¨ä¸€å€‹å‘é‡ç©ºé–“ä¸­ æ¯”è¼ƒè¿‘ å› ç‚ºæœ‰ç›¸ä¼¼çš„çµæ§‹)
è·Ÿdemo 
å¯èƒ½åªæœ‰...çš„é‚£ä¸€å¡Šæ˜¯å·®ä¸å¤šçš„

capa ->è·‘å‡ºå ±å‘Š
æœƒé›¢åŸæœ¬çš„å¾ˆè¿‘ å°±æœƒè·‘


å¦‚æœçœŸçš„è¦AI
ç›¸ä¼¼åº¦çš„æ¼”ç®—æ³•(æ¯”å°)

æ¨è–¦capaæ˜¯å› ç‚ºå®ƒæ˜¯baseline ï¼ˆAIæ‡‰è©²å¾ˆé›£è¶…éï¼‰




åšæƒ…è³‡
<!-- åŸºæ–¼èšé¡åˆ†ææŠ€è¡“çš„æƒ¡æ„ç¨‹å¼è®Šé«”è¾¨è­˜æ–¹æ³•ç ”ç©¶ -->
<!-- åŸºæ–¼èšé¡åˆ†ææŠ€è¡“çš„æƒ¡æ„è»Ÿé«”è®Šé«”è¾¨è­˜æ–¹æ³•ç ”ç©¶ -->




## è€å¸«0730ä¸‹åˆ èªªæƒ³çœ‹åˆ°çš„
- éœæ…‹æª”æ¡ˆ
- APIç‰¹å¾µ
- æ€éº¼è½‰åŒ–æˆTechniqueé€™å¼µè¡¨
    - ï¼ˆæ²’æœ‰å¾ˆå®¹æ˜“ï¼‰


### å·²æœ‰ä¸»é¡Œ


## æˆ‘å€‘æœ‰çš„æŠ€èƒ½
ä¸²AI
å€å¡Šéˆ
çˆ¬æš—ç¶²
æµé‡åˆ†æ

# æ¯æ—¥ç¸½çµ

## D1çµè«–
### ~~æ˜å¤©å†èªª~~
q



## D2çµè«–
### æš«å®šä¸»é¡Œ"åŸºæ–¼èšé¡åˆ†ææŠ€è¡“çš„æƒ¡æ„è»Ÿé«”è®Šé«”è¾¨è­˜æ–¹æ³•ç ”ç©¶"
### çµ±æ•´open-source-Malwareåˆ†é¡

## D3çµè«–
### ç¢ºèªå°ˆé¡Œè£½ä½œé¡Œç›®
### æŠ“å–wannacryæœ¬é«”åŠè®Šé«”æ¨£æœ¬ä¸¦åˆ†æ
### åˆ†æcapaå ±å‘Šä¸éœ€è¦çœ‹çš„ATT&CKè·ŸMBCé¡å‹



---
çµ„å“¡
å³ç¥å„’(èŠå§†)
é„­å®‡å…©(è²å¦)
æ›¹å‡±ç¿”(l3obo)
è”¡å£«ç…’(å°è”¡)









